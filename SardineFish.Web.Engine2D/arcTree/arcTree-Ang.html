<!DOCTYPE HTML>
<html>
    <head>
        <title>ArcTree</title>
        <script src="jquery.min.js"></script>
        <script src="../SardineFish.Web.js"></script>
        <script src="../SardineFish.Web.UI.js"></script>
        <script src="../SardineFish.Web.Engine2D.js"></script>
        <script src="../SardineFish.Web.Engine2D.Colliders.js"></script>
        <script src="../SardineFish.Web.Engine2D.GUI.js"></script>
<!--
        <meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no,target-densitydpi=device-dpi" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="browsermode" content="application" />
        <meta name="full-screen" content="true" />
        <meta name="x5-fullscreen" content="true" />
        <meta name="x5-page-mode" content="app" />
        <meta name="360-fullscreen" content="true" />
-->
        <style>
html{
    /*-ms-touch-action: none; 
    overflow: hidden;*/
}
body{
    padding: 0px;
    margin:0px;
    background-color: white;
}
#canvas{
    background-color: #FaFaFa;
}

        </style>
    </head>
    <body>
        <canvas id="canvas" width="1920" height="1080"/>
    </body>
    <script>
try
{
    var PI=Math.PI;
    var tan=Math.tan;
    var k=0.55;
    var lk=k/(k+1);
    var ang=0;
    var fps = 120;
    var t=10;
    var dAng=PI/fps/t;
    var length = 200;
    var arcLength = 180;
    var depth = 9;//Math.log(1/length)/Math.log(k);
    //alert(depth);
    var w=PI;// angle v
    var bgColor=new Color(35,35,35,1);
    var color=new Color(218, 252, 255, 1);
    var lineWidth=1;//px
    var lineCap=Graphics.LineCap.Butt;
    var zoom=2;
    var cameraFocus=new Point(0,250);
    
    
    var canvas=$("canvas").get(0);
    var game=Game.createByCanvas(canvas);
    var scene=game.scene;
    var gui=new GUI();
    var camera=scene.camera;
    var graphics=camera.graphics;
    var lineList=[];
    lineList[0]=new Line(new Point(0,-100),new Point(0,100));
    lineList[0].ang=PI/2;
    
    var nextList=[];
    var arcLList=[];
    var arcRList=[];
    var arcList=[];
    
    var textDepth;
    var arcBG;
    var arcAng;
    var arcAngText;
    var arcR = 50;
    var arcLineWidth = 3;
    var arcPosition = new Point(1700, 930);
    
    function init()
    {
        scene.GUI=gui;
        gui.scene=scene;
        camera.moveTo(cameraFocus.x,cameraFocus.y);
        camera.zoomTo(zoom);
        game.start();
        
        textDepth=new Text("Arc Tree");
        textDepth.moveTo(30,graphics.height/2);
        textDepth.font.fontFamily="Segoe UI";
        textDepth.font.fontStyle=100;
        textDepth.font.fontSize=100;
        textDepth.fillStyle="white";
        //gui.addControl(textDepth);

        arcBG = new Circle(arcR);
        arcBG.strokeWidth = arcLineWidth;
        arcBG.strokeStyle = new Color(46, 53, 76, 1);
        arcBG.fillStyle = new Color(0, 0, 0, 0);
        arcBG.moveTo(arcPosition.x, arcPosition.y);
        gui.addControl(arcBG);

        arcAng = new Arc(arcPosition, arcR, -PI / 2, 0);
        arcAng.strokeWidth = arcLineWidth;
        arcAng.strokeStyle = color;
        arcAng.fillStyle = new Color(0, 0, 0, 0);
        gui.addControl(arcAng);

        arcAngText = new GUI.TextBlock("30°");
        arcAngText.color = color;
        arcAngText.font.fontFamily = "Segoe UI";
        arcAngText.font.fontStyle = 100;
        arcAngText.font.fontSize = 30;
        arcAngText.verAlign = VerAlign.Bottom;
        arcAngText.horAlign = HorAlign.Right;
        arcAngText.margin = new Thickness(0, 124, 0, 200);
        arcAngText.onRender = function (e)
        {
            e.x = arcPosition.x;
            e.y = arcPosition.y-3;
        }

        gui.addControl(arcAngText);

        scene.onRender=function(graphics,dt)
        {
            camera.clear(bgColor);
            draw(graphics);
            
        }
        
        scene.onEndRender = function ()
        {

        }
        
    }
    init();
    function draw(graphics)
    {
        ang += dAng;
        arcAng.end = -PI / 2 + ang;
        arcAngText.text = parseInt(ang / (PI * 2) * 360) + "°";
        if (ang > 2 * PI)
        {
            arcAng.end -= PI * 2;
            arcAng.strokeStyle = new Color(0, 114, 255);
            arcBG.strokeStyle = color;
        }
        lineList = [];
        length = arcLength / (ang * lk * tan((PI - ang) / 2));
        lineList[0] = new Line(new Point(0, 100 - (length * (1 - lk))), new Point(0, 100 + (length * lk)));
        lineList[0].ang=PI/2;

        //alert(dAng);
        for(var i=0;i<depth;i++)
        {
            next(i,graphics);
        }
    }
    function next(d,graphics)
    {
        try{
        if(d>=depth)
        {
            return;
        }
        //textDepth.text="Depth="+d;
        arcList.addRange(arcLList);
        arcList.addRange(arcRList);
        
        nextList=[];
        arcLList=[];
        arcRList=[];
        for(var i=0;i<lineList.length;i++)
        {
            var line=lineList[i];
            var v=Vector2.fromPoint(line.p1,line.p2);
            var vl=Vector2.multi(v,k);
            var vr=Vector2.multi(v,k);
            //alert(vl);
            vl.rotate(ang);
            //alert(vl);
            vr.rotate(-ang);
            var lineL=new Line(line.p2,new Point(line.p2.x+vl.x,line.p2.y+vl.y));
            var lineR=new Line(line.p2,new Point(line.p2.x+vr.x,line.p2.y+vr.y));
            lineL.ang=line.ang-ang;
            lineR.ang=line.ang+ang;
            nextList.add(lineL);
            nextList.add(lineR);
            vl=Vector2.multi(v,lk*tan((PI-ang)/2));
            vr=Vector2.multi(v,lk*tan((PI-ang)/2));
            vl.rotate(PI/2);
            vr.rotate(-PI/2);
            rl=vl.toLine((line.p2.x-line.p1.x)*(1-lk)+line.p1.x,(line.p2.y-line.p1.y)*(1-lk)+line.p1.y);
            rr=vr.toLine(rl.p1.x,rl.p1.y);
            var ol=rl.p2;
            var or=rr.p2;
            var r=vl.mod();
            var arcL=new Arc(ol,r,line.ang-(PI/2),line.ang-(PI/2)-ang,true);
            var arcR=new Arc(or,r,line.ang+(PI/2),line.ang+(PI/2)+ang,false);
            arcL.lineCap=lineCap;
            arcR.lineCap=lineCap;
            arcL.strokeWidth=lineWidth;
            arcR.strokeWidth=lineWidth;
            arcL.strokeStyle=color;
            arcR.strokeStyle=color;
            arcL.render(graphics);
            arcR.render(graphics);
            //arcLList.add(arcL);
            //arcRList.add(arcR);
            //arcL.render(graphics);
            //arcR.render(graphics);
            
            /*rl.strokeStyle="blue";
            rr.strokeStyle="red";
            rl.render(graphics);
            rr.render(graphics);
            
            lineR.strokeStyle=Color.random();
            lineL.strokeStyle=Color.random();
            lineL.render(graphics);
            lineR.render(graphics);*/
        }
        lineList=nextList;
        //setTimeout(next,1000);
        
    
        }catch(ex){alert("next:"+i+ex.message);}
    }
}
catch(ex)
{
    alert("global:"+ex.message);
}
    </script>
</html>/html>ml>