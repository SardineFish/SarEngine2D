<!DOCTYPE HTML><html>    <head>        <title>Running Game</title><script src="jquery.min.js"></script>        <script src="../SardineFish.Web.js"></script>        <script src="../SardineFish.Web.UI.js"></script>        <script src="../SardineFish.Web.Engine2D.js"></script>        <script src="../SardineFish.Web.Engine2D.GUI.js"></script>        <meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no,target-densitydpi=device-dpi" />        <meta name="apple-mobile-web-app-capable" content="yes" />        <meta name="browsermode" content="application" />        <meta name="full-screen" content="true" />        <meta name="x5-fullscreen" content="true" />        <meta name="x5-page-mode" content="app" />        <meta name="360-fullscreen" content="true" />        <style>            html{                -ms-touch-action: none;  /*Direct all pointer events to JavaScript code. */                overflow: hidden;            }            body{                margin: 0px;                padding: 0px;                background-color: rgb(240,240,240);            }            #debug{                display: none;                position: fixed;                 top: 0px;                left: 0px;                z-index: 1000;                color: red;            }            #textCount{                position: fixed;                display: none;                float: left;                z-index: 1000;            }            #menu{                background-color: white;                position: fixed;                top: 0px;                display: block;                width: 100%;                height: 100%;                /*text-align: center;*/            }            #menuContent{                display: block;                position: fixed;                width: 100%;                height: 70%;                top: 30%;            }            #startMenu{                position: relative;                max-width: 200px;                margin: auto;                top: 15%;            }            #title{                text-align: center;                font-size: 1cm;            }            #score{                margin-top:3mm;                text-align: center;            }            #score:before{                content: "last: ";            }            #score:after{                content: "px";            }            #maxScore{                margin-top:5mm;                text-align: center;            }            #maxScore:before{                content: "Max distance: ";            }            #maxScore:after{                content: "px";            }            #buttonStart{                font-size: 5mm;            }        </style>        <link rel="stylesheet" type="text/css" href="runningGame.css" />    </head>    <body oncontextmenu="return false;"><!--        <a href="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js" download="jquery.min.js" >jquery.min.js</a>        -->        <p id="debug" >debug</p>        <p id="textCount">0</p>        <div id="menu">            <div id="menuContent" >                <p id="title">Running Game<i style="font-size:5mm;"> v1.0</i></p>                <p id="maxScore">0</p>                <p id="score">0</p>                <div id="startMenu">                    <p class="button" id="buttonStart" style="display:block;">Start</p>                </div>                <div id="overMenu">                </div>            </div>        </div>        <div>            <canvas id="canvas" width="480" height="500"></canvas>            <div style="height: 200px; background-color:black"></div>        </div>                <script>try{    Math.sign = function (x)    {        if (isNaN(x) || x == 0)            return 0;        if (x > 0)            return 1;        else            return -1;    }//alert($("#menuContent").height());//call SardineFish;//alert(Engine2D.Web);var width=0,height=0;var lastP=false;//alert(LinkList);var canvas=document.getElementById("canvas");Graphics.canvas = canvas;var lineList=new Array();var pList=[];var lastLine=false;var lastCol=false;var calcu=false;var O=false;var scene = new Scene;var camera = new Camera(width / 2, height / 2, width, height, 1.00);var graphics = new Graphics(canvas);camera.graphics = graphics;scene.camera = camera;camera.zoomTo(1);var game = new Game.createByCanvas(canvas);game.setScene(scene);SardineFish.Web.Engine2D.onError=alert;scene.physics.g.y=-1000;var walkSpeed=100;var runSpeed=300;var nextGround=0;var groundWidth=100;var P=0.7;var leftLimit=null;var man = null;var runing = false;var moving = false;var zoom=0.35;var walkAnimation;var walkLAnimation;var walkRAnimation;var standAnimation;var standLAnimation;var standRAnimation;var runAnimation;var runLAnimation;var runRAnimation;var crouchAnimation;var crouchLAnimation;var crouchRAnimation;var jumpAnimation;var jumpLAnimation;var jumpRAnimation;var noneCount=0;var groundCount=0;function setGround(x){    if(Math.random()<P||noneCount>1)    {        noneCount=0;        groundCount++;        var ground = new Ground(0, x, x+groundWidth);        var g = ground.toGameObject();        ground = new Rectangle(groundWidth, 200);        ground.rigidBody=true;        ground.static=true;        ground.soft=false;        ground.setCenter(x, 0, Align.topLeft);        ground.fillStyle = new Color(0, 0, 0, 1.00);        g.collider=ground;        g.graphic = ground;        g.name="ground";         g.onUpdate=function(obj,dt)        {            if(obj.collider.xR<camera.center.x-width/2)                scene.removeGameObject(obj.id);        }        scene.addGameObject(g);    }    else    {         groundCount=0;         noneCount++;    }    nextGround=x+groundWidth;}function walkTo(x){    var v=Math.sign(x-man.position.x)*walkSpeed;    if(v>0)    {        man.graphic = walkRAnimation.copy();    }    else    {        groundCount=0;        man.graphic = walkLAnimation.copy();    }    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    man.v.x=v;}function runTo(x){    var v=Math.sign(x-man.position.x)*runSpeed;    man.graphic = runRAnimation.copy();    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    man.v.x=v;}function gameOver(){    $("#menu").css("display","block");    $("#menu").animate({opacity: 1},500);    var maxScore=window.localStorage.getItem("score");    var score=man.position.x;    score=Math.floor(score);    maxScore=Math.max(maxScore,score);    window.localStorage.setItem("score",maxScore);    $("#maxScore").text(maxScore);    $("#score").text(score);    scene.reset();    scene.camera=camera;    //init();    camera.moveTo(width/2,height/2);    //game.start();}var highJump=false;var jumping=false;function jumpTo(y){    if(jumping)        return;    jumping=true;    var h=y-man.position.y;    if(h<=0)        return;    man.graphic = jumpRAnimation.copy();    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    man.graphic.fps = 60;    man.graphic.onFrameUpdate=function(f)    {        var v=0;        if(f>=8)        {//alert(man.collider.landed);            if(man.collider.landed)            {                if(highJump)                {                    //highJump=false;                    h*=2;                }                v = Math.sqrt(Math.abs(2 * scene.physics.g.y * h));//alert(v);                man.gravity=true;                man.v.y=v;            }            man.graphic.onFrameUpdate=null;        }    }}function init(){    try{    var p = new Point(width*(1-0.618), height/2);    var ground = new Ground(0, 0, width);    var g = ground.toGameObject();    ground = new Rectangle(width, 200);    nextGround=width;    ground.setCenter(0, 0, Align.topLeft);    ground.fillStyle = new Color(0, 0, 0, 1.00);    g.graphic = ground;    g.name="ground";    scene.addGameObject(g);    var obj = new GameObject();    obj.graphic = standAnimation.copy();    obj.graphic.onFrameUpdate=function(f)    {    }    obj.graphic.setCenter(p.x, p.y, Align.bottomCenter);    var rect=new Rectangle(160*zoom,350*zoom);    rect.rigidBody=true;    rect.bounce=0;    rect.setCenter(p.x,p.y,Align.bottomCenter);    obj.collider=rect;    obj.onCollide=onCollide;      obj.setCenter(p.x, p.y);    obj.name = "animation";    obj.onUpdate = onUpdate;    obj.mass=1;    man = obj;    scene.addGameObject(obj);    obj.name = "animation" + obj.id;    $("#textCount").text(pList.length.toString());    scene.onTouchStart=onTouchStart;    scene.onMouseDown=onTouchStart;    scene.onTouchEnd=onTouchEnd;    scene.onMouseUp=onTouchEnd;    scene.onClick = function(e)    {        return;        if(!man.collider.landed)            return;        runTo(width);        scene.onClick=null;        scene.onTouchStart=onTouchStart;    };        }catch(ex){alert("init:"+ex.message);}}function onCollide(e){    if(e.target.name!="ground")        return;//alert("!");    if(e.relativeV.y)    {        jumping=false;        var v=Math.abs(e.relativeV.y);        k=Math.sqrt(v/50);        fps=30*k;        if(highJump)        {            jumpTo(50);            return;        }        man.graphic = runRAnimation.copy();        man.v.x=300;        man.graphic.fps=30;        man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    }    }function onUpdate(obj,delay){    var y=obj.position.y;    var x=obj.position.x;    if(y<-200)    {        game.onEnd=gameOver;        game.end();    }    $("#textCount").text(Math.floor(x)+","+Math.floor(y));    y=y<height/2-50?height/2-50:y;    P=(Math.pow(0.99996,x)*0.7);    camera.moveTo(camera.position.x+man.v.x*delay, y);    if(camera.center.x+width/2>=nextGround)        setGround(nextGround);}//---------------Click---------------$("#buttonStart").click(function(e){    try{    $("#menu").animate({opacity: 0},500,function()    {        $("#menu").css("display","none");    });    game.start();    init();    }catch(ex){alert("buttonStart.click:"+ex.message);}});function onTouchStart(e){    try    {        highJump=true;        if(!man.collider.landed)            return;            jumpTo(50);    }catch(ex){alert("onTouchStart:"+ex.message);}}function onTouchEnd(e){    highJump=false;}function resize(){    width=screen.availWidth;    height =screen.availHeight-50;//alert("("+width+","+height+")");    $("body").css("width",width.toString()+"px");    document.getElementById("canvas").width=width;    document.getElementById("canvas").height=height;    camera.setCenter(width / 2, height / 2, Align.center);}resize();function drawLine(x1,y1,x2,y2){    ctx=canvas.getContext("2d");    ctx.beginPath();    ctx.moveTo(x1,y1);    ctx.lineTo(x2,y2);    ctx.strokeStyle="white";    ctx.stroke();}function canvasUp(e){    }window.onload=function(e){    try    {        SardineFish.Web.UI.setButton($(".button"));        walkAnimation = new ImageAnimation();        walkAnimation = ImageAnimation.loadFromUrl("walk.png", 0, 0, 160, 350,160*zoom,350*zoom, 18, 30, function ()        {        });        walkRAnimation = ImageAnimation.loadFromUrl("walk.png", 0, 0, 160, 350,160*zoom,350*zoom, 18, 30, function ()        {        });        walkLAnimation = ImageAnimation.loadFromUrl("walk.png", 0, 351, 160, 350,160*zoom,350*zoom, 18, 30, function ()        {        });        standAnimation = ImageAnimation.loadFromUrl("stand.png", 0, 0, 160, 350, 160 * zoom, 350 * zoom, 1, 1);        standLAnimation = ImageAnimation.loadFromUrl("standLeft.png", 0, 0, 160, 350, 160 * zoom, 350 * zoom, 1, 1);        standRAnimation = ImageAnimation.loadFromUrl("stand.png", 0, 0, 160, 350, 160 * zoom, 350 * zoom, 1, 1);        runAnimation = ImageAnimation.loadFromUrl("run.png", 0, 0, 260, 350, 260*zoom, 350*zoom, 38, 30, function ()         {             runAnimation.loop.from = 22;        });        runLAnimation = ImageAnimation.loadFromUrl("run.png", 0, 350, 260, 350, 260*zoom, 350*zoom, 38, 30, function ()         {             runLAnimation.loop.from = 22;        });        runRAnimation = ImageAnimation.loadFromUrl("run.png", 0, 0, 260, 350, 260*zoom, 350*zoom, 38, 30, function ()         {             runRAnimation.loop.from = 22;        });        runAnimation.loop.from = 12;        crouchAnimation = ImageAnimation.loadFromUrl("crouch.png", 0, 0, 200, 340, 200*zoom, 340*zoom, 11, 30, function ()        {            crouchAnimation.loop.enable = false;        });        crouchRAnimation = ImageAnimation.loadFromUrl("crouch.png", 0, 0, 200, 340, 200*zoom, 340*zoom, 11, 30, function ()        {            crouchRAnimation.loop.enable = false;        });        crouchLAnimation = ImageAnimation.loadFromUrl("crouch.png", 0, 340, 200, 340, 200*zoom, 340*zoom, 11, 30, function ()        {            crouchLAnimation.loop.enable = false;        });        jumpRAnimation = ImageAnimation.loadFromUrl("jump.png", 0, 0, 220, 350, 200*zoom, 340*zoom, 11, 30, function ()        {            jumpRAnimation.loop.enable = false;        });        jumpLAnimation = ImageAnimation.loadFromUrl("jump.png", 0, 350, 220, 350, 200*zoom, 340*zoom, 11, 30, function ()        {            jumpLAnimation.loop.enable = false;        });    var ctx=document.getElementById("canvas").getContext("2d");    //alert(ctx);    ctx.fillRect(0,0,width,height);        SardineFish.Web.Engine2D.debug.write=function(text)    {//alert(text);        $("#debug").text(text);    }    SardineFish.Web.Engine2D.debug.clear=function()    {        $("#debug").text("");    }    var score=window.localStorage.getItem("score");    if(!score)        score=0;    window.localStorage.setItem("score",score);    $("#maxScore").text(score);}catch(ex){alert("window.load:"+ex.message);}}}catch(ex){    alert(ex.message);}        </script>    </body></html>