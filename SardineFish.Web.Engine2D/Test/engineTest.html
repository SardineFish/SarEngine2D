<!DOCTYPE HTML><html>    <head>        <title>Test</title><script src="jquery.min.js"></script>        <script src="../SardineFish.Web.js"></script>        <script src="../SardineFish.Web.Engine2D.js"></script>        <meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no,target-densitydpi=device-dpi" />        <meta name="apple-mobile-web-app-capable" content="yes" />        <meta name="browsermode" content="application" />        <meta name="full-screen" content="true" />        <meta name="x5-fullscreen" content="true" />        <meta name="x5-page-mode" content="app" />        <meta name="360-fullscreen" content="true" />        <style>            html{                -ms-touch-action: none;  /*Direct all pointer events to JavaScript code. */                overflow: hidden;            }            body{                margin: 0px;                padding: 0px;                background-color: rgb(240,240,240);            }            #debug{                display: block;                position: fixed;                 top: -10px;                left: 0px;                z-index: 1000;                color: red;            }            #textCount{                display: none;            }        </style>    </head>    <body><!--        <a href="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js" download="jquery.min.js" >jquery.min.js</a>        -->        <p id="debug" >debug</p>        <p id="textCount">0</p>        <canvas id="canvas" width="480" height="500" />                <script>try{//call SardineFish;//alert(Engine2D.Web);var width=0,height=0;var lastP=false;//alert(LinkList);var canvas=document.getElementById("canvas");Graphics.canvas=canvas;var lineList=new Array();var pList=[];var lastLine=false;var lastCol=false;var calcu=false;var O=false;var scene=new Scene;var game=new Game.createByCanvas(canvas);game.setScene(scene);var walkAnimation;function resize(){    width=screen.availWidth;    height =screen.availHeight;//alert("("+width+","+height+")");    $("body").css("width",width.toString()+"px");    document.getElementById("canvas").width=width;    document.getElementById("canvas").height=height;    }resize();function drawLine(x1,y1,x2,y2){    ctx=canvas.getContext("2d");    ctx.beginPath();    ctx.moveTo(x1,y1);    ctx.lineTo(x2,y2);    ctx.strokeStyle="white";    ctx.stroke();}function canvasUp(e){    }function onUpdate(obj,delay){        for(var i=0;i<pList.length;i++)    {        var k=10000;        var p=pList[i];        if(p.name==obj.name)            continue;        var x=p.position.x-obj.position.x;        var y=p.position.y-obj.position.y;        var f=-(k*p.e*obj.e)/(x*x+y*y);        obj.force(new Force(x, y, f));        if (obj.position.x <= 0 || obj.position.x >= width)        {            scene.removeGameObject(obj.id);            return;        }        else if (obj.position.y <= 0 || obj.position.y >= height)        {            scene.removeGameObject(obj.id);            return;        }    }}function canvasDown2(e){    var p=new Point(e.pageX,e.pageY);    var circle=new Circle(p.x,p.y,3);    var obj=new GameObject();    obj.            circle;    obj.setCenter(p.x,p.y);    obj.name = "partical" + pList.length;    if(pList.length%2)    {        circle.strokeStyle="red";        circle.fillStyle="red";        obj.e=1;    }    else    {        circle.strokeStyle="#66CCFF";        circle.fillStyle="#66CCFF";        obj.e=-1;    }    obj.onUpdate=onUpdate;    pList[pList.length]=obj;    scene.addGameObject(obj);    $("#textCount").text(pList.length.toString());//alert(obj.name);}function canvasDown(e){    try{    var ctx=document.getElementById("canvas").getContext("2d");        if(calcu)    {        Graphics.clear(canvas);        calcu=false;    }    ctx.fillStyle="white"    ctx.fillRect(e.pageX,e.pageY,1,1);    ctx.fillStyle="black";    if(!lastP)    {        lastP=new Point(e.pageX,e.pageY);        if(lastCol)            lastCol.setCenter(lastP.x,lastP.y);    }    else    {        if(!lastCol)        {            var p=new Point(e.pageX,e.pageY);            var t=new Text("0");            t.fillStyle="red";            //t.strokeStyle="blue";            t.drawToCanvas(canvas,p.x,p.y);            /*            var r=Math.sqrt((p.x-lastP.x)*(p.x-lastP.x)+(p.y-lastP.y)*(p.y-lastP.y));            lastCol=new Circle(lastP.x,lastP.y,r);                        lastCol.drawToCanvas(canvas,lastCol.center.x,lastCol.center.y);            lastP=false;            */            drawLine(lastP.x,lastP.y,e.pageX,e.pageY);            var p=new Point(e.pageX,e.pageY);            lineList[lineList.length]=new Line(lastP,p);            lastP=p;            if(lineList.length==3)            {                drawLine(lastP.x,lastP.y,lineList[0].p1.x,lineList[0].p1.y);                var l=new Line(lastP,lineList[0].p1);                var pList=new Array();                pList[0]=l.p1;                for(var i=0;i<lineList.length;i++)                    pList[i+1]=lineList[i].p1;                lastCol=new Polygon(pList);                                lastCol.strokeStyle.red=255;                var obj=new GameObject();//alert(obj.position);                obj.onUpdate=function(obj,delay)                {                    var v=obj.v.getLength();                    var r=160;                    var f=new Force(obj.v.y,-obj.v.x,v*v*obj.mass/r);//alert(obj.force);                    obj.force(f);                    //obj.force.y=-obj.v.x;                }                obj.graphic=lastCol;                obj.drawToCanvas(canvas);                lastCol=obj;                lastP=false;                lineList=new Array();            }                                 }        else        {                        var p=new Point(e.pageX,e.pageY);            lastCol.v=new Vector2(p.x-lastP.x,p.y-lastP.y);            lastCol.force(new Force(p.x-lastP.x,p.y-lastP.y));            var scene=new Scene();            scene.addGameObject(lastCol);            var game=new Game.createByCanvas(canvas);            game.setScene(scene);            game.start();            /*            var col=lastCol.copy();            //alert(lastCol.copy);            col.moveTo(p.x,p.y);            col.drawToCanvas(canvas);                        var r=Math.sqrt((p.x-lastP.x)*(p.x-lastP.x)+(p.y-lastP.y)*(p.y-lastP.y));            var circle=new Circle(lastP.x,lastP.y,r);            circle.drawToCanvas(canvas,circle.center.x,circle.center.y);            if(circle.isCollideWith(lastCol))                alert("!");                        var p=new Point(e.pageX,e.pageY);            var line=new Line(lastP,p);            Graphics.drawLine(canvas,lastP.x,lastP.y,p.x,p.y,"red");            var v1=new Vector2(lastCol.center.x-line.p1.x, lastCol.center.y-line.p1.y);            var v2=new Vector2(line.p2.x-line.p1.x, line.p2.y-line.p1.y);            var x=v1.x*v2.y-v2.x*v1.y;            var l=v2.x*v2.x+v2.y*v2.y;            l=Math.sqrt(l);            x=Math.abs(x/l);            Graphics.drawCircle(canvas, lastCol.center.x,lastCol.center.y,x);            if(line.isCross(lastCol))                alert("!");            calcu=true;            lastCol=false;            lastP=false;                        drawLine(lastP.x,lastP.y,e.pageX,e.pageY);            var p=new Point(e.pageX,e.pageY);            lineList[lineList.length]=new Line(lastP,p);                        lastP=p;            if(lineList.length==3)            {                drawLine(lastP.x,lastP.y,lineList[0].p1.x,lineList[0].p1.y);                var l=new Line(lastP,lineList[0].p1);                var pList=new Array();                pList[0]=l.p1;                for(var i=0;i<lineList.length;i++)                    pList[i+1]=lineList[i].p1;                col=new Polygon(pList);                col.drawToCanvas(canvas);                if(col.isCollideWith(lastCol))                    alert("!");                calcu=true;                lastP=false;                lastCol=false;                lineList=new Array();            }            */        }    }    }catch(ex){alert(ex.message);}}window.onload=function(e){    try    {        walkAnimation = new ImageAnimation();        walkAnimation = ImageAnimation.loadFromUrl("walk.png", 0, 0, 160, 350, 18, 30, function ()        {        });    var ctx=document.getElementById("canvas").getContext("2d");    //alert(ctx);    ctx.fillRect(0,0,width,height);    $("#canvas").mousedown(canvasDown2);    $("#canvas").mouseup(canvasUp);    SardineFish.Web.Engine2D.debug.write=function(text)    {//alert(text);        $("#debug").text(text);    }    SardineFish.Web.Engine2D.debug.clear=function()    {        $("#debug").text("");    }    game.start();}catch(ex){alert(ex.message);}}}catch(ex){    alert(ex.message);}        </script>    </body></html>