<!DOCTYPE HTML><html>    <head>        <title>Animation Game</title><script src="jquery.min.js"></script>        <script src="../SardineFish.Web.js"></script>        <script src="../SardineFish.Web.UI.js"></script>        <script src="../SardineFish.Web.Engine2D.js"></script>        <script src="../SardineFish.Web.Engine2D.GUI.js"></script>        <meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no,target-densitydpi=device-dpi" />        <meta name="apple-mobile-web-app-capable" content="yes" />        <meta name="browsermode" content="application" />        <meta name="full-screen" content="true" />        <meta name="x5-fullscreen" content="true" />        <meta name="x5-page-mode" content="app" />        <meta name="360-fullscreen" content="true" />        <style>            @font-face            {                font-family: "fontIcon";                src: url("segmdl2.woff");            }            html{                -ms-touch-action: none;  /*Direct all pointer events to JavaScript code. */                overflow: hidden;            }            body{                margin: 0px;                padding: 0px;                background-color: rgb(240,240,240);            }            .ctrlButton{                padding: 10px;                border: 2px solid black;                border-radius: 5px;                //background-color: rgba(0,0,0,0.3);            }            .fontIcon{                font-family: "fontIcon";            }                        #debug{                display: block;                position: fixed;                 top: -10px;                left: 0px;                z-index: 1000;                color: red;            }            #textCount{                position: fixed;                display: block;                float: left;            }            #GUI{                position: absolute;                width: 100%;                height: 100%;                top: 0px;                z-index: 100;                background-color: rgba(255,128,128,0);                display: none;            }            #control{                position: absolute;                bottom: 1cm;                left: 1cm;                text-align: center;                font-size: 26px;            }                        #ctrlUp{                margin: 5px;                display: inline-block;                /*float: left;*/                clear: both;            }            #ctrlDown{                margin: 5px;                float: left;            }            #ctrlLeft{                margin: 5px;                float: left;            }            #ctrlRight{                margin: 5px;                float: left;            }        </style>    </head>    <body oncontextmenu="return false;"><!--        <a href="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js" download="jquery.min.js" >jquery.min.js</a>        -->        <p id="debug" >debug</p>        <p id="textCount">0</p>        <div>            <canvas id="canvas" width="480" height="500"></canvas>            <div style="height: 200px; background-color:black"></div>            <div id="GUI">                <div id="control">                    <div id="ctrlUp" class="ctrlButton fontIcon" >&#xE010</div>                    <div>                        <div id="ctrlLeft" class="ctrlButton fontIcon" >&#xE012</div>                        <div id="ctrlDown" class="ctrlButton fontIcon" >&#xE011</div>                        <div id="ctrlRight" class="ctrlButton fontIcon" >&#xE013</div>                    </div>                                    </div>            </div>        </div>                <script>try{    Math.sign = function (x)    {        if (isNaN(x) || x == 0)            return 0;        if (x > 0)            return 1;        else            return -1;    }//alert(Math.sign);//call SardineFish;//alert(Engine2D.Web);var width=0,height=0;var lastP=false;//alert(LinkList);var canvas=document.getElementById("canvas");Graphics.canvas = canvas;var lineList=new Array();var pList=[];var lastLine=false;var lastCol=false;var calcu=false;var O=false;var scene = new Scene;var camera = new Camera(width / 2, height / 2, width, height, 1.00);var graphics = new Graphics(canvas);camera.graphics = graphics;scene.camera = camera;var game = new Game.createByCanvas(canvas);game.setScene(scene);scene.physics.g.y=-360;//scene.eventSource=$("#GUI").get(0);//scene.initEvents();var gui=new GUI();scene.GUI=gui;var buttonUp= new GUI.Button("\uE010");buttonUp.font.fontFamily="fontIcon";buttonUp.font.fontSize=30;buttonUp.padding=new Thickness(10);buttonUp.margin.right=10;buttonUp.margin.bottom=75;buttonUp.verAlign=VerAlign.Bottom;buttonUp.horAlign=HorAlign.Right;scene.GUI.addControl(buttonUp);var buttonLeft= new GUI.Button("\uE012");buttonLeft.font.fontFamily="fontIcon";buttonLeft.font.fontSize=30;buttonLeft.padding=new Thickness(10);buttonLeft.margin.left=10;buttonLeft.margin.bottom=10;buttonLeft.verAlign=VerAlign.Bottom;scene.GUI.addControl(buttonLeft);var buttonDown= new GUI.Button("\uE011");buttonDown.font.fontFamily="fontIcon";buttonDown.font.fontSize=30;buttonDown.padding=new Thickness(10);buttonDown.margin.right=10;buttonDown.margin.bottom=10;buttonDown.verAlign=VerAlign.Bottom;buttonDown.horAlign=HorAlign.Right;scene.GUI.addControl(buttonDown);var buttonRight= new GUI.Button("\uE013");buttonRight.font.fontFamily="fontIcon";buttonRight.font.fontSize=30;buttonRight.padding=new Thickness(10);buttonRight.margin.left=70;buttonRight.margin.bottom=10;buttonRight.verAlign=VerAlign.Bottom;scene.GUI.addControl(buttonRight);var walkSpeed=100;var runSpeed=300;var leftLimit=null;var man = null;var runing = false;var moving = false;var zoom = 0.5;var nextAction = true;var katanaAction = 0;var walkAnimation;var walkLAnimation;var walkRAnimation;var standAnimation;var standLAnimation;var standRAnimation;var runAnimation;var runLAnimation;var runRAnimation;var crouchAnimation;var crouchLAnimation;var crouchRAnimation;var jumpAnimation;var jumpLAnimation;var jumpRAnimation;var katanaOut1Animation;var katanaOut2Animation;var katanaCut1RAnimation;var katanaCut2RAnimation;function stopAction(){
    if (!nextAction)
        return;    man.graphic = standAnimation.copy();    man.v.x = 0;    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);}function walkL(){    man.graphic = walkLAnimation.copy();    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    man.v.x=-walkSpeed;}function walkR(){    man.graphic = walkRAnimation.copy();    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    man.v.x=walkSpeed;}function walkTo(x){    var v=Math.sign(x-man.position.x)*walkSpeed;    if(v>0)    {        man.graphic = walkRAnimation.copy();    }    else    {        man.graphic = walkLAnimation.copy();    }    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    man.v.x=v;}function runL(x)
{    var v = -runSpeed;    man.graphic = runLAnimation.copy();
    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    man.v.x = v;
}function runR(x)
{
    var v = runSpeed;    man.graphic = runRAnimation.copy();
    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    man.v.x = v;
}function runTo(x){    var v=Math.sign(x-man.position.x)*runSpeed;    if(v>0)    {        man.graphic = runRAnimation.copy();    }    else    {        man.graphic = runLAnimation.copy();    }    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    man.v.x=v;}function jumpTo(h){    if(h<=0)        return;    if(man.v.x>=0)    {        man.graphic = jumpRAnimation.copy();    }    else    {        man.graphic = jumpLAnimation.copy();    }    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    man.graphic.fps = 30*300/h;    man.graphic.onFrameUpdate=function(f)    {        var v=0;        if(f>=5)        {            v = Math.sqrt(Math.abs(2 * scene.physics.g.y * h));            man.graphic.fps = 30*h/100;            man.graphic.time=1/man.graphic.fps*5;            man.graphic.fps=man.graphic.fps < 15 ? 15: man.graphic.fps;            man.graphic.onFrameUpdate=function(F)            {                if(F>=8)                {                    man.gravity=true;                    man.v.y=v;                    man.graphic.onFrameUpdate=null;                }            }            return 5;        }    }}function crouch(){}function standUp(){}function katanaOut(){
    if (!nextAction)
        return;
    stopAction();
    man.graphic = katanaOut1Animation.copy();
    man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);
    man.graphic.onEnd = function ()
    {
        man.graphic = katanaOut2Animation.copy();
        man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);
        nextAction = true;
    }
    nextAction = false;
}function katanaCutR(){
    if (!nextAction)
        return;
    stopAction();
    if (katanaAction == 0)
    {
        man.graphic = katanaCut1RAnimation.copy();
        man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);
        man.graphic.onFrameUpdate = function (f)
        {
            if (f >= 15)
            {
                katanaAction = 1;
                nextAction = true;
            }
        }
    }
    if (katanaAction == 1)
    {
        man.graphic = katanaCut2RAnimation.copy();
        man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);
        man.graphic.onFrameUpdate = function (f)
        {
            if (f >= 20)
            {
                katanaAction = 1;
                nextAction = true;
            }
        }
    }
    nextAction = false;
}buttonLeft.onTouchStart=walkL;buttonLeft.onTouchEnd=stopAction;buttonRight.onTouchStart=walkR;buttonRight.onTouchEnd=stopAction;function onCollide(e){    if(e.target.name!="ground")        return;    if(e.relativeV.y)    {        var v=Math.abs(e.relativeV.y);        k=Math.sqrt(v/50);        fps=30*k;        if(man.v.x>=0)            man.graphic = crouchRAnimation.copy();        else            man.graphic = crouchLAnimation.copy();        man.v.x=0;        if(v<300)        {            man.graphic.fCount=Math.floor(v/300*man.graphic.fCount)        }        man.graphic.onBegine=function()        {            //alert(man.graphic.frame);        }        //man.graphic.onFrameUpdate=function(f){alert(f);}        man.graphic.onEnd=function()        {            if(man.graphic.reverse)                return;            man.graphic.reverse=true;            man.graphic.play();        }        man.graphic.fps*=k;        man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);    }    }function onUpdate(obj,delay){    var y=obj.position.y;    var x=obj.position.x;    y=y<height/2-50?height/2-50:y;    if(x-width/2<leftLimit.position.x)    {        x=leftLimit.position.x+width/2;    }    else        leftLimit.moveTo(x-width/2,0);    camera.moveTo(x, y);}//---------------Click---------------scene.onTouchStart = function (e){}scene.onClick=canvasClick0;scene.onDoubleClick=function(e){    if(!man.collider.landed)        return;    var p = new Point(e.x, e.y);    if(Math.abs(p.x-man.position.x)>Math.abs(p.y-man.position.y))        runTo(p.x);}function manClick(e){    if (man.collider.landed)    {        if (man.v.x >= 0)        {            man.graphic = standRAnimation.copy();            man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);        }        else if (man.v.x < 0)        {            man.graphic = standLAnimation.copy();            man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);        }        e.handled = true;        man.v.x = 0;    }}function manDoubleClick(e){    if (man.collider.landed)    {        if (man.v.x >= 0)        {            man.graphic = crouchRAnimation.copy();            man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);        }        else if (man.v.x < 0)        {            man.graphic = crouchLAnimation.copy();            man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);        }        e.handled = true;        man.v.x = 0;    }}scene.onMouseUp = function (e){    if (e.button == Mouse.Buttons.Right)    {        //camera.moveTo(e.x, e.y);    }}function canvasClick0(e){    try{    var p = new Point(e.x, e.y);    var ground = new Ground(0, 0, width*100);    var g = ground.toGameObject();//alert(Rectangle);    ground = new Rectangle(width*100, 10);    ground.setCenter(0, 0, Align.topLeft);    g.graphic = ground;    g.name="ground";    scene.addGameObject(g);    var wall = new Rectangle(10, 400);    wall.setCenter(0, 0, Align.bottomCenter);    wall.rigidBody = true;    wall.static = true;    wall.soft = false;    var wo = new GameObject();    wo.graphic = wall;    wo.collider = wall;    wo.gravity = false;    scene.addGameObject(wo);    leftLimit=wo;    var obj = new GameObject();    obj.graphic = standAnimation.copy();    obj.graphic.onFrameUpdate=function(f)    {    }    obj.graphic.setCenter(p.x, p.y, Align.bottomCenter);    var rect=new Rectangle(160*zoom,350*zoom);    rect.rigidBody=true;    rect.bounce=0;    rect.setCenter(p.x,p.y,Align.bottomCenter);    obj.collider=rect;    obj.onCollide=onCollide;      obj.setCenter(p.x, p.y);    obj.name = "animation";    obj.onUpdate = onUpdate;    obj.mass=1;    man = obj;    man.hitTest=true;    man.onClick = manClick;    man.onDoubleClick = manDoubleClick;    scene.addGameObject(obj);    obj.name = "animation" + obj.id;    $("#textCount").text(pList.length.toString());    scene.onClick = null;    }catch(ex){alert("scene.onClick0:"+ex.message);}//alert(obj.name);}//---------------Keyboard---------------scene.onKeyDown = function (e){    if (e.key == Keyboard.Keys.W || e.key == Keyboard.Keys.Up)
    {
        jumpTo(100);
    }    if (e.key ==Keyboard.Keys.S||e.key==Keyboard.Keys.Down)    {        crouch();    }    if (e.key ==Keyboard.Keys.D || e.key ==Keyboard.Keys.Right)    {        walkR();        if (e.shift)            runR();    }    if (e.key == Keyboard.Keys.A || e.key == Keyboard.Keys.Left)    {
        walkL();
        if (e.shift)
            runL();
    }
    if (e.key == Keyboard.Keys.R)
    {
        katanaOut();
    }    if (e.key == Keyboard.Keys.J)    {
        katanaCutR();

    }}scene.onKeyUp = function (e){    if (e.key == Keyboard.Keys.A || e.key == Keyboard.Keys.Left)    {        stopAction();    }    if (e.key == Keyboard.Keys.D || e.key == Keyboard.Keys.Right)
    {
        stopAction();    }    if (e.key == Keyboard.Keys.W || e.key == Keyboard.Keys.Up)
    {
        stopAction();    }    if (e.key == Keyboard.Keys.S || e.key == Keyboard.Keys.Down)
    {
        stopAction();    }    if (e.key == Keyboard.Keys.Shift)    {        if (moving)        {            man.graphic = walkAnimation.copy();            man.v.x = 100;            man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);        }        else        {            man.graphic = standAnimation.copy();            man.v.x = 0;            man.graphic.setCenter(man.position.x, man.position.y, Align.bottomCenter);        }        runing = false;    }}function resize(){    width=$("#GUI").width();    height=$("#GUI").height();    //height =screen.availHeight;//alert("("+width+","+height+")");    $("body").css("width",width.toString()+"px");    document.getElementById("canvas").width=width;    document.getElementById("canvas").height=height;    camera.setCenter(width / 2, height / 2, Align.center);}resize();function drawLine(x1,y1,x2,y2){    ctx=canvas.getContext("2d");    ctx.beginPath();    ctx.moveTo(x1,y1);    ctx.lineTo(x2,y2);    ctx.strokeStyle="white";    ctx.stroke();}function canvasUp(e){    }window.onload=function(e){    try    {        SardineFish.Web.UI.setButton($(".ctrlButton"),ButtonStyle.ColorExchange);        walkAnimation = new ImageAnimation();        walkAnimation = ImageAnimation.loadFromUrl("walk.png", 0, 0, 160, 350,160*zoom,350*zoom, 18, 30, function ()        {        });        walkRAnimation = ImageAnimation.loadFromUrl("walk.png", 0, 0, 160, 350,160*zoom,350*zoom, 18, 30, function ()        {        });        walkLAnimation = ImageAnimation.loadFromUrl("walk.png", 0, 351, 160, 350,160*zoom,350*zoom, 18, 30, function ()        {        });        standAnimation = ImageAnimation.loadFromUrl("stand.png", 0, 0, 160, 350, 160 * zoom, 350 * zoom, 1, 1);        standLAnimation = ImageAnimation.loadFromUrl("standLeft.png", 0, 0, 160, 350, 160 * zoom, 350 * zoom, 1, 1);        standRAnimation = ImageAnimation.loadFromUrl("stand.png", 0, 0, 160, 350, 160 * zoom, 350 * zoom, 1, 1);        runLAnimation = ImageAnimation.loadFromUrl("Run.png", 0, 345, 340, 345, 340*zoom, 345*zoom, 55, 30, function ()         {             runLAnimation.loop.from = 35;        });        runRAnimation = ImageAnimation.loadFromUrl("Run.png", 0, 0, 340, 345, 340*zoom, 345*zoom, 55, 30, function ()         {             runRAnimation.loop.from = 35;        });        crouchAnimation = ImageAnimation.loadFromUrl("crouch.png", 0, 0, 200, 340, 200*zoom, 340*zoom, 11, 30, function ()        {            crouchAnimation.loop.enable = false;        });        crouchRAnimation = ImageAnimation.loadFromUrl("crouch.png", 0, 0, 200, 340, 200*zoom, 340*zoom, 11, 30, function ()        {            crouchRAnimation.loop.enable = false;        });        crouchLAnimation = ImageAnimation.loadFromUrl("crouch.png", 0, 340, 200, 340, 200*zoom, 340*zoom, 11, 30, function ()        {            crouchLAnimation.loop.enable = false;        });        jumpAnimation = ImageAnimation.loadFromUrl("jump.png", 0, 0, 220, 350, 200*zoom, 340*zoom, 11, 30, function ()        {            jumpAnimation.loop.enable = false;        });        jumpRAnimation = ImageAnimation.loadFromUrl("jump.png", 0, 0, 220, 350, 200*zoom, 340*zoom, 11, 30, function ()        {            jumpRAnimation.loop.enable = false;        });        jumpLAnimation = ImageAnimation.loadFromUrl("jump.png", 0, 350, 220, 350, 200*zoom, 340*zoom, 11, 30, function ()        {            jumpLAnimation.loop.enable = false;        });        katanaOut1Animation = ImageAnimation.loadFromUrl("Katana_Out_1.png", 0, 0, 430, 345, 430 * zoom, 345 * zoom, 55, 30, function ()
        {
            katanaOut1Animation.loop.enable = false;
        });        katanaOut2Animation = ImageAnimation.loadFromUrl("Katana_Out_2.png", 0, 0, 430, 345, 430 * zoom, 345 * zoom, 16, 30, function ()
        {
            katanaOut2Animation.loop.enable = false;
        });        katanaCut1RAnimation = ImageAnimation.loadFromUrl("Katana_Cut_1_R.png", 0, 0, 640, 425, 640 * zoom, 425 * zoom, 21, 30, function ()
        {
            katanaCut1RAnimation.loop.enable = false;
        });        katanaCut2RAnimation = ImageAnimation.loadFromUrl("Katana_Cut_2_R.png", 0, 0, 560, 480, 560 * zoom, 480 * zoom, 26, 30, function ()
        {
            katanaCut2RAnimation.loop.enable = false;
        });    var ctx=document.getElementById("canvas").getContext("2d");    //alert(ctx);    ctx.fillRect(0,0,width,height);        $("#canvas").mouseup(canvasUp);    SardineFish.Web.Engine2D.debug.write=function(text)    {//alert(text);        $("#debug").text(text);    }    SardineFish.Web.Engine2D.debug.clear=function()    {        $("#debug").text("");    }    game.start();}catch(ex){alert(ex.message);}}}catch(ex){    alert("global:"+ex.message);}        </script>    </body></html>